# 0. 프로젝트 명
💳 FraudDetectionSyetem (가제)

## 프로젝트 기간
2026.01.11.Sun ~ 2023.01.14.Wed (4 days)

# 1. 문제 정의
## 1.1. 프로젝트 시나리오 개요
신용카드 거래는 신용을 기반으로 이루어지는 대표적인 금융 거래로, 거래의 신뢰성과 안전성은 카드사와 고객 모두에게 매우 중요한 요소이다. 특히 카드 소유주 본인이 아닌 제 3자에 의해 이루어지는 부정거래(Fraud Transaction)는 고객의 금전적 손실뿐 아니라 카드사에 대한 신뢰 저하로 이어질 수 있다.

카드사 입장에서는 정상 거래가 압도적으로 많기 때문에 단순 정확도(Accuracy)에 기반한 판단만으로는 부정 거래를 효과적으로 탐지하기가 어렵다. 실제로 소수의 부정 거래를 놓칠 경우 고객 피해로 직결되므로, 부정 거래를 얼마나 정확히 탐지할 수 있는지가 핵심 과제이다.

이에 본 프로젝트에서는 과거 신용카드 거래 정보를 활용하여, 각 거래가 정상 거래인지 부정 거래인지를 인공지능 모델로 판단하는 시스템을 구축하고자 한다. 이를 통해 향후 발생하는 모든 카드 결제 거래에 대해 실시간 이상 거래 탐지 및 사전 경고가 가능한 서비스 구축의 기초 단계를 마련하는 것을 목표로 한다. 특히 부정 거래 비율이 매우 낮은 특성을 고려하여, 단순 정확도가 아닌 Precision-Recall 곡선 기반 지표(AUPRC)를 중심으로 모델 성능을 평가하고, 실제 금융 서비스 환경에 적합한 이상 거래 탐지 모델을 구현하는 것을 핵심 문제로 정의하였다.

</br>

# 2. 데이터 설명
## 2.1. 데이터 세트 개요
본 프로젝트에서는 신용카드 부정 거래 탐지를 위한 공개 데이터 세트인 Credit Card Fraud Detection 을 사용하였다. 해당 데이터는 실제 유럽 카드 이용자의 거래 기록을 기반으로 구성된 데이터로, 금융 거래 환경에서 발생하는 이상 거래를 분석하기에 적합한 구조를 가진다.
- 데이터 세트명: Credit Card Fraud Detection
- 데이터 출처: Kaggle – Credit Card Fraud Detection (https://www.kaggle.com/datasets/mlg-ulb/creditcardfraud)
- 데이터 수집 시점: 2013년 9월
- 총 거래 건수: 284,807건
- 총 컬럼 수: 31개

## 2.2. 데이터 구성 및 변수 설명
데이터는 개별 신용카드 거래 단위로 구성되어 있으며, 각 거래에 대해 총 31개의 수치형 변수가 제공된다. 이 중 거래 시간과 거래 금액을 제외한 대부분의 변수는 개인정보 보호 및 보안상의 이유로 PCA(Principal Component Analysis)를 통해 변환된 값이다.

|변수명|설명|
|------|----|
|`Time`|	첫 번째 거래 발생 시점을 기준으로 경과한 시간(초 단위)
|`V1` ~ `V28`|	원본 거래 정보를 PCA로 차원 축소한 수치형 변수
|`Amount`|	해당 거래의 결제 금액
|`Class`|	이상 거래 여부 (0: 정상 거래, 1: 부정 거래)

`Time` 변수는 절대적인 거래 시각이 아닌, 데이터 내 첫 거래 이후 경과 시간을 나타내며 거래 간 시간 간격 분석에 활용될 수 있다.
`Amount` 변수는 거래 금액 정보를 포함하고 있어, 부정 거래 탐지 시 거래 규모에 따른 위험도 판단이나 비용 민감 학습(cost-sensitive learning) 에 활용 가능하다.

## 2.3. 데이터 특성 및 분석 시 고려사항
해당 데이터 세트의 가장 큰 특징은 심각한 클래스 불균형(Class Imbalance) 이다. 전체 284,807건의 거래 중 부정 거래(Class = 1)는 492건에 불과하며, 이는 전체 거래의 약 0.172% 수준이다. 이로 인해 정상 거래(Class = 0)가 압도적으로 많은 구조를 가진다.

이러한 데이터 특성상 단순 정확도(Accuracy)를 모델 성능 지표로 사용할 경우, 부정 거래를 거의 탐지하지 못하더라도 높은 정확도가 나타날 수 있다. 따라서 본 프로젝트에서는 부정 거래 탐지 성능을 보다 정밀하게 평가하기 위해 Precision-Recall 기반 평가 지표(`ROC_AUC`)를 중심으로 모델을 분석한다.

또한 PCA로 변환된 변수들(V1~V28)은 원본 의미를 직접적으로 해석하기 어렵기 때문에, 본 프로젝트에서는 변수 중요도 분석 및 설명가능한 AI(XAI)를 이용하여 각 변수가 이상 거래 판별에 미치는 상대적 영향을 분석한다.

</br>

# 3. 탐색적 자료 분석(EDA) 및 변수 선정(Feature Selection)
## 3.1. 데이터 전처리
데이터의 품질을 점검하고, 변수 간 스케일 차이로 인한 왜곡을 최소화하기 위해 데이터 전처리 과정을 수행하였다.

```
(1) 결측치 분석(Missing Data check) -> (2) 이상치 점검(Outlier Check) -> (3) 데이터 스케일링(Data Scaling)
```

먼저 전체 데이터에 대해 결측치(Missing Data)여부를 확인한 결과, 모든 변수에서 결측치는 존재하지 않았다. 그 다음 이상치 점검의 경우, 데이터의 특성에 의하여 처리하지 않았다. 마지막으로 데이터 스케일링의 경우 `Log Transform`과 `Min-Max Scaling`을 진행하였다.
이러한 전처리 과정을 통해 변수 간 상대적 영향력을 균형 있게 조정하였으며, 특정 변수의 크기 차이가 모델 학습에 과도한 영향을 미치는 문제를 최소화 하였다.

## 3.2. 데이터 시각화 및 분석
본 절에는 전처리된 데이터를 바탕으로 PLS(Partial Least Squares) 기반 시각화 결과를 통해 정상 거래와 이상 거래의 분포 특성과 주요 변수의 기여도를 분석하였다. 특히 차원 축소 이후의 공간에서 클래스 간 분리 가능성과 변수 간 관계를 직관적으로 파악하는 데 목적이 있다.

### 3.2.1. PLS Biplot 분석
<div align="center">
 <img src="/figures/result-figure-1-PLS-Biplot-2-Components.png" width="400"/> <img src="/figures/result-figure-2-PLS-Biplot-3-Components.png" width="400"/>
</div>

2-Components로 분석 결과 정상 거래와 이상 거래는 명확히 분리되기보다는 일부 중첩된 구조를 가진다. 벡터들을 분석하면, `V17`, `V14`, `V12`의 변수가 정상거래에 큰 설명력을 띔을 확인할 수 있다. 반면, 3-Components로 분석한 결과 정상 거래와 이상 거래가 약간 분리됨을 보였다. 특히 `V17` 방향(위의 그림)으로 포맷팅을 하고 확인해 본 결과, 이상 거래 변수들끼리 뭉쳐있으나, 일부 중첩된 부분이 존재되었다. 따라서 변수를 선별하여(변수 축소) 모델링을 진행하는 방법을 선택하였다.

</br>
<div align="center">
 <img src="/figures/result-figure-3-VIP-Scores.png" width="500"/>
 </div>

위의 PLS 분석 결과 기반의 VIP Scores를 산출해 보았다. 기준을 VIP >= 1.21로 둔 다음 분석한 결과 `V17`, `V14`, `V12`, `V10`, `V3`, `V16`, `V7`}이 높은 상관성을 띄었다. 분석 전, 주요 변수라고 생각했던 `Amount`와 `Time`의 경우 낮은 점수를 띄고 있었다. 현재는 데이터가 보안상의 이유로 더 엄밀하게 접근 할 수 없으나, 훗날 데이터가 PCA 차원축소가 되어있지 않다면, 더 다양한 분석 기법을 활용하여 점검할 수 있을 것으로 사료된다.

</br>

## 3.3. 변수 선정
본 절에서는 여러 기법에서 반복적으로 중요하게 나타난 변수를 선택하여 평균 Rank 기반의 누적평가를 통해 상위 10개의 변수를 선별하려고 한다(Consensus 기반). 사용될 방법론은 아래와 같다.

|그룹	|기법	|중요도 |기준|
|-|-|-|-|
|선형 관계|	Pearson	|단변량 선형 상관|
|        |	Ridge	|다변량 선형 + L2 패널티|
|        |	Lasso	|다변량 선형 + 변수 선택|
|        |	Elastic Net	|Ridge + Lasso|
|비선형 관계|	Spearman	|단변량 순위 상관|
|          |	MI	|일반적 비선형 의존성|
|잠재공간 기반|	PLS-VIP	|X–Y 공분산 기여도|

<div align="center">
 <img src="/figures/result-figure-4-Feature-Selection.png" width="500"/>
</div>
분석 결과 상위 10개의 변수는 `V17`, `V14`, `V12`, `V10`, `V7`, `V16`, `V3`, `V11`, `V4`, `V9`이다. 가장 높은 Rank를 차지한 `V17`의 경우 모든 분석 결과에서 높은 관계를 나타내었다. 눈에 띄는 점은 5번째 Rank인 `V7`의 경우 모든 변수 중에서 `Ridge`의 결과가 가장 높았다. 이는 Ridge가 공동 기여 변수를 높게 평가하기 때문이다. `V7`은 단독으로는 약한 변수일 지라도, 다른 변수와 함께 있을 때, 예측에 크게 기여한다는 의미이다.

3. Modeling_ Ensemble modeling - `VotingClassifier`
- `LogistRegression`, `RandomForestClassifier`, `LGBMClassifier`, `XGBClassifier`
- `예측 -> 검증 -> 변수중요도 확인`
- Comparison Analysis
  - 기존의 단일 모델에 비해 앙상블 모델의 성능을 체크함.

4. Fine Tunning

5. XAI
- Global XAI
- Local XAI
- SHAP Importance Comparison

## 최종 코드 및 결과

